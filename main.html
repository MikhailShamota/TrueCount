<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width'/>
    <title>True count</title>
    <link rel="stylesheet" type="text/css" href="main.css">
    <link rel="stylesheet" href="material.min.css">
    <script src="material.min.js"></script>

    <script src="js/three.js"></script>
    <script type="text/javascript" src="js/RequestAnimationFrame.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/stats.min.js"></script>
    <script src="js/Octree.js"></script>
    <script src="js/THREE.MeshLine.js"></script>
    <script src="my_js/OctreeParticles.js"></script>
</head>
<body>
<div id="Stats-output">
</div>

<script type="text/javascript" src="my_js/TrueCount.js"></script>
<!--<script type="text/javascript" src="my_js/elasticdata.js"></script>-->
<script type="text/javascript" src="my_js/filedata.js"></script>

<!--TEST DATA-->
<table class="wrapper" id="dMenu" style="width: 100%;height: 100%;background-color: #686868; position: absolute; top:0; bottom: 0;left: 0; right: 0; margin: auto;text-align: center" >
    <tr><td>
        <div id="MainMenu">
            <h3>&#9813</h3>
            <h1>True Count</h1>

            <input type="file" name="file" id="file" class="inputfile" multiple />
            <label for="file">&#128194 Choose a file</label>
        </div>
   </td></tr>
</table>
<script>


    document.getElementById('file').addEventListener('change', handleFileSelect, false);

    function handleFileSelect( event ) {

        //document.getElementById('MainMenu').style.display = 'none';
        document.getElementById("dMenu").style.display = 'none';

        var files = event.target.files;
        var loadedCount = 0;

        var nodeParent = { id: "--", parent: null, weight: 20000, doc: null };
        TrueCount.loadNode( nodeParent );

        for ( var i = 0; i < files.length; i++ ) {

            var loadedSize = 0;
            var fileName = files[ i ].name;

            parseFile(
                    files[ i ],
                    function( str, loaded, fileSize ) {

                    //console.log( str );
                    //console.log( '============CHUNK==============');
                    loadedSize += loaded;
                    console.log( fileName + " " + loadedSize +" bytes loaded of " + fileSize);

                    str.split('\n').map( function( line ) {

                        parseLine( line );
                    });
                    },
                    function() {

                        loadedCount++;

                        if ( loadedCount >= files.length ) {

                            TrueCount.drawNodes();
                            TrueCount.drawLinks();
                        }
                    });
        }
    }

    function parseLine( str ) {

        try {

            var rec = JSON.parse( str );

            if ( rec.Items ) {

                for ( var i = 0; i < rec.Items.length - 1; i++ )
                    for ( var j = i + 1; j < rec.Items.length; j++ ) {

                        var nodeIdsrc = rec.Items[i].ItemId;
                        var nodeIddst = rec.Items[j].ItemId;
                        var weight = 1;
                        var doc = rec.id;

                        TrueCount.loadBranch({
                            src: nodeIdsrc,
                            dst: nodeIddst,
                            doc: doc,
                            weight: weight
                        });

                        var nodeSrc = { id: nodeIdsrc, parent: "--", weight: 1, doc: null };
                        var nodeDst = { id: nodeIddst, parent: "--", weight: 1, doc: null };
                        TrueCount.loadNode( nodeSrc );
                        TrueCount.loadNode( nodeDst );

                    }

            } else {

                rec.alias = rec.document.name;
                TrueCount.loadNode( rec );
            }
        } catch (e) {

        }

    }

    TrueCount.init();
    TrueCount.draw();
</script>





</body>
</html>